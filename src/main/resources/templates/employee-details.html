<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Employee Details</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
  <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<script>
  var currentDate = new Date().toISOString().split('T')[0];
  function setMaxDate() {
    var dateField = document.getElementById('birthDate');
    dateField.setAttribute('max', currentDate);
  }
</script>
<body onload="setMaxDate()">
<form class="card" th:object="${employee}" action="#" th:action="@{/update-employee}" method="post">
  <div class="text-center" >
    <img class="rounded-circle circle-image" src="#" th:src="@{'data:image/jpeg;base64,' + ${employee.image}}" alt="Employee Image">
    <div class="mt-3">
      <label for="newImage" class="btn btn-secondary">
        Choose New Image
        <input type="file" id="newImage" style="display: none;" accept="image/*" onchange="previewNewImage(event)" readonly>
      </label>
      <button id="removeImage" type="button" class="btn btn-danger ml-2" onclick="removeCurrentImage()" disabled>Remove Current Image</button>
    </div>
  </div>
  <div>
    <div class="mb-3">
      <input type="hidden" class="form-control" id="id" th:value="${employee.id}" th:field="*{id}">
      <input type="hidden" class="form-control" id="image" th:value="${employee.image}" th:field="*{image}">
    </div>
    <div class="mb-3">
      <label for="personalNumber" class="form-label">Personal Number</label>
      <input type="text" class="form-control" id="personalNumber" th:value="${employee.personalNumber}" th:field="*{personalNumber}" readonly>
    </div>
    <div class="mb-3">
      <label for="firstName" class="form-label">First Name</label>
      <input type="text" class="form-control" id="firstName" th:value="${employee.firstName}" th:field="*{firstName}" readonly>
    </div>
    <div class="mb-3">
      <label for="lastName" class="form-label">Last Name</label>
      <input type="text" class="form-control" id="lastName" th:value="${employee.lastName}" th:field="*{lastName}" readonly>
    </div>
    <div class="mb-3">
      <label for="birthDate" class="form-label">Birth Date</label>
      <input type="date" class="form-control" id="birthDate" th:value="${employee.birthDate}" th:field="*{birthDate}" readonly>
    </div>
    <button type="button" class="btn btn-primary" id="editButton">Edit</button>
    <button type="submit" class="btn btn-primary" id="saveButton" disabled>Save</button>
    <a class="btn btn-secondary" th:href="@{/employee}">Close</a>
  </div>
</form>
</body>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script>
  document.getElementById("editButton").addEventListener("click", function() {
    document.getElementById("firstName").removeAttribute("readonly");
    document.getElementById("lastName").removeAttribute("readonly");
    document.getElementById("birthDate").removeAttribute("readonly");
    document.getElementById("saveButton").removeAttribute("disabled");
    document.getElementById("newImage").removeAttribute("disabled");
    document.getElementById("removeImage").removeAttribute("readonly");
    // document.getElementById("sex").removeAttribute("readonly");
    // document.getElementById("cnapsNumber").removeAttribute("readonly");
    // document.getElementById("departureDate").removeAttribute("readonly");
    // document.getElementById("childrenInCharge").removeAttribute("readonly");
    // document.getElementById("function").removeAttribute("readonly");
    // document.getElementById("idCardDeliveredDate").removeAttribute("readonly");
    // document.getElementById("idCardDeliveredPlace").removeAttribute("readonly");
    // document.getElementById("idCardNumber").removeAttribute("readonly");
    // document.getElementById("address").removeAttribute("readonly");
    // document.getElementById("professionalEmail").removeAttribute("readonly");
    // document.getElementById("personalEmail").removeAttribute("readonly");
  });

  function previewNewImage(event) {
    const input = event.target;
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const previewImage = document.querySelector('.circle-image');
        previewImage.src = e.target.result;
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  function removeCurrentImage() {
    const previewImage = document.querySelector('.circle-image');
    previewImage.src = '#'; // Replace this with the default image URL or empty string to display nothing.
  }
</script>
</html>